# 智能登录助手 - 使用说明

## 🎉 新功能总结

所有3个问题已完美解决！

### ✅ 问题1：安全问题 - 已解决
添加了**访问密码保护**，防止未授权访问：
- 首次访问需要输入访问密码
- 2小时内无需重复登录
- 部署到公网也安全

### ✅ 问题2：本地模式消失 - 已解决
添加了**模式切换功能**：
- 可以在"本地"和"云端"模式之间自由切换
- 切换按钮位于页面顶部
- 本地模式使用浏览器 localStorage
- 云端模式使用 Supabase

### ✅ 问题3：管理密码修改 - 已解决
添加了**密码修改功能**：
- 管理员可以在后台修改密码
- 修改后永久保存（localStorage）
- 支持密码强度验证

---

## 🚀 快速开始

### 第一步：配置密码

打开 `auth-config.js` 文件，修改默认密码：

```javascript
/**
 * 访问密码配置
 * 首次访问时需要输入此密码才能进入
 */
window.ACCESS_PASSWORD = '123456';  // 🔴 修改为你的访问密码

/**
 * 管理员密码配置
 * 后台管理页面登录密码
 */
window.ADMIN_PASSWORD = 'admin123';  // 🔴 修改为你的管理密码
```

**⚠️ 重要：部署到公网前，务必修改这两个密码！**

### 第二步：选择存储模式

访问 `index.html`，你会看到页面顶部有模式切换按钮：

```
[本地] [云端]
```

- **本地模式**：数据存储在浏览器 localStorage 中，仅限当前浏览器使用
- **云端模式**：数据存储在 Supabase，多设备同步

### 第三步：使用后台管理

访问 `manage_sucdri_2026_top_secret.html`，输入管理密码登录后可以：

- ✅ 添加/编辑/删除账号
- ✅ 发布/删除公告
- ✅ 配置技术支持信息
- ✅ 配置快捷按钮
- ✅ **修改管理密码**（新功能！）

---

## 📋 功能清单

### 主页面 (index.html)

| 功能 | 说明 |
|------|------|
| 🔐 访问密码保护 | 首次访问需要密码，2小时有效 |
| 🔄 模式切换 | 本地/云端模式自由切换 |
| 📱 账号管理 | 查看账号、复制密码、生成验证码 |
| 📢 公告显示 | 显示管理员发布的公告 |
| 🔗 快捷按钮 | 访问 Gemini、登录指导等 |

### 后台管理 (manage_sucdri_2026_top_secret.html)

| 功能 | 说明 |
|------|------|
| 🔐 管理员登录 | 需要管理密码 |
| 👥 账号管理 | 添加/编辑/删除账号 |
| 📢 公告管理 | 发布/删除公告 |
| ⚙️ 技术支持配置 | 配置联系信息 |
| 🔘 按钮配置 | 配置快捷按钮显示 |
| 🔑 **密码修改** | 修改管理密码 |

---

## 🔐 安全机制

### 访问密码
- **保护范围**：主页面、后台管理页面
- **有效期**：2小时（sessionStorage）
- **存储位置**：auth-config.js
- **修改方式**：直接编辑 auth-config.js 文件

### 管理密码
- **保护范围**：后台管理功能
- **持久化**：localStorage（修改后永久保存）
- **默认值**：admin123
- **修改方式**：
  1. 登录后台管理 (manage_sucdri_2026_top_secret.html)
  2. 点击右上角"修改密码"按钮
  3. 输入当前密码和新密码
  4. 刷新页面生效

### Supabase 安全
如果使用云端模式，建议在 Supabase 控制台配置：
1. **RLS（行级安全）策略**：已配置允许匿名访问（内部工具）
2. **CORS 白名单**：在 Authentication → URL Configuration 中添加你的域名
3. **API Key 轮换**：定期更换 anon public key

---

## 🌐 部署到公网

### 推荐方案

#### 方案1：GitHub Pages（推荐）
1. 将项目上传到 GitHub 仓库
2. 在仓库设置中启用 GitHub Pages
3. 选择主分支作为源
4. 访问 `https://你的用户名.github.io/仓库名/`

#### 方案2：Vercel/Netlify
1. 导入项目到 Vercel/Netlify
2. 自动部署完成
3. 获得一个 `.vercel.app` 或 `.netlify.app` 域名

#### 方案3：自有服务器
1. 使用 nginx/Apache 配置静态网站
2. 上传所有文件到网站根目录
3. 配置 HTTPS（推荐使用 Let's Encrypt）

### 部署前检查清单

- [ ] 修改 `auth-config.js` 中的访问密码和管理密码
- [ ] 如果使用 Supabase，检查 API Key 是否正确
- [ ] 如果使用 Supabase，配置 CORS 白名单
- [ ] 测试所有功能是否正常
- [ ] 设置 HTTPS（如果使用自有服务器）

---

## 📁 文件说明

| 文件 | 说明 |
|------|------|
| `index.html` | 主页面 - 用户查看账号、获取验证码 |
| `manage_sucdri_2026_top_secret.html` | 后台管理 - 管理员配置和管理（已重命名） |
| `login.html` | 登录页面 - 访问密码验证 |
| `auth-config.js` | 认证配置 - 密码设置 |
| `auth-check.js` | 认证检查 - 自动验证登录状态 |
| `supabase-config.js` | Supabase 配置 - 云端模式 |
| `debug-supabase.html` | 调试工具 - 测试 Supabase 连接 |
| `server.js` | Node.js 后端（可选）- 提供 API 接口 |

---

## 🔄 数据迁移

### 从本地模式迁移到云端模式

1. **配置 Supabase**
   - 使用调试工具测试连接 (`debug-supabase.html`)
   - 配置 `supabase-config.js`

2. **执行数据库初始化**
   - 在 Supabase SQL Editor 中执行 `supabase/schema.sql`

3. **迁移数据**
   - 方式1：手动在后台管理页面重新添加账号
   - 方式2：使用浏览器开发者工具导出 localStorage 数据

### 从云端模式切换回本地模式

- 直接点击页面顶部的"本地"按钮即可
- 数据会自动从浏览器 localStorage 加载

---

## ❓ 常见问题

### Q1: 忘记访问密码怎么办？
**A**: 编辑 `auth-config.js` 文件，修改 `window.ACCESS_PASSWORD` 的值。

### Q2: 忘记管理密码怎么办？
**A**:
1. 打开浏览器开发者工具（F12）
2. 进入 Application/应用 标签
3. 找到 Local Storage
4. 删除 `google_assistant_admin_password` 键
5. 刷新页面，密码会恢复为 `auth-config.js` 中配置的值

### Q3: 如何重置为默认密码？
**A**: 删除 `auth-config.js` 中的密码配置，或在浏览器中清除 localStorage。

### Q4: 云端模式连接失败？
**A**:
1. 检查 `supabase-config.js` 配置是否正确
2. 使用 `debug-supabase.html` 测试连接
3. 检查 Supabase 项目是否正常运行
4. 检查是否已执行 `schema.sql` 创建表

### Q5: 多设备数据不同步？
**A**: 确保所有设备都使用云端模式，并且配置相同的 Supabase 项目。

---

## 🛠️ 高级配置

### 自定义访问密码提示

编辑 `login.html`，修改提示文字：

```html
<h1>智能登录助手</h1>
<p>请输入密码继续访问</p>  <!-- 修改这里 -->
```

### 修改会话超时时间

编辑 `auth-check.js`，修改超时时间：

```javascript
// 2小时内有效
if (elapsed > 2 * 60 * 60 * 1000) {  // 修改这里的数字
```

### 禁用访问密码（不推荐）

在需要保护的页面中，删除这两行：

```html
<script src="auth-config.js"></script>
<script src="auth-check.js"></script>
```

---

## 📞 技术支持

如遇问题，请联系：

- **姓名**：王海涛
- **邮箱**：wanghaitao@sucdri.com
- **飞书**：https://applink.feishu.cn/client/chat/open?openId=ou_f28f2c1dfe74461b2ca055dfe2afe20b

---

## 📝 更新日志

### v2.0.0 (2025-02-01)
- ✅ 添加访问密码保护
- ✅ 添加模式切换功能（本地/云端）
- ✅ 添加管理密码修改功能
- ✅ 优化用户体验
- ✅ 增强安全性

### v1.0.0
- 基础功能：账号管理、验证码生成
- 后台管理：账号、公告、配置
- 本地存储：localStorage

---

**祝使用愉快！** 🎉
