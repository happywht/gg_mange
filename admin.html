<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>系统管理 - 智能登录助手</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Supabase 和认证系统（按顺序加载） -->
  <script src="supabase-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="auth-manager.js"></script>
  <script src="auth-check.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    .password-strength { height: 4px; border-radius: 2px; background: #e5e7eb; overflow: hidden; }
    .password-strength-fill { height: 100%; transition: all 0.3s; }
  </style>
</head>
<body class="bg-slate-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const supabase = (typeof window !== 'undefined' && window.SUPABASE_URL && window.SUPABASE_ANON_KEY && typeof window.supabase !== 'undefined')
      ? window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY)
      : null;
    const useSupabase = !!supabase;

    const STORAGE_KEYS = {
      accounts: 'google_assistant_accounts',
      announcement: 'google_assistant_announcement',
      config: 'google_assistant_config'
    };
    const DEFAULT_CONFIG = {
      contact: { name: '王海涛', email: 'wanghaitao@sucdri.com', openId: 'ou_f28f2c1dfe74461b2ca055dfe2afe20b' },
      buttons: {
        guide: { visible: true, text: '登录指导', url: '' },
        gemini: { visible: true, text: '访问 Gemini', url: 'https://gemini.google.com/app' }
      }
    };
    // 优先使用 auth-config.js 中的密码，否则使用 localStorage 中的密码，最后使用默认密码
    const ADMIN_PASSWORD = window.ADMIN_PASSWORD || localStorage.getItem('google_assistant_admin_password') || 'admin123';


    // 图标组件
    const Icon = ({ name, size = 20, className = "" }) => {
      const icons = {
        user: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
        key: <><path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4.1a1 1 0 0 0-1.4 0l-2.1 2.1a1 1 0 0 0 0 1.4Z" /><path d="m10.5 12.5 1.5 1.5" /><path d="M11 11l4.5-4.5" /><path d="M4.5 16.5 7 14" /><path d="M3 21l3-3" /><path d="m21 3-5 5" /><path d="M14 9a7 7 0 1 1-10 10 7 7 0 0 1 10-10Z" /></>,
        plus: <><path d="M12 5v14" /><path d="M5 12h14" /></>,
        trash: <><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><path d="M10 11v6" /><path d="M14 11v6" /></>,
        edit: <><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /><path d="m15 5 4 4" /></>,
        save: <><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></>,
        bell: <><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" /><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" /></>,
        message: <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10Z" />,
        refresh: <><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" /><path d="M16 21h5v-5" /></>,
        database: <><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></>,
        settings: <><path d="M12.22 2h-.44a2 2 0 0 1-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></>,
        home: <><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></>,
        lock: <><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></>,
        check: <path d="M20 6 9 17l-5-5" />,
        x: <><path d="M18 6 6 18" /><path d="M6 6l12 12" /></>,
        eye: <><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></>,
        eyeOff: <><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" /><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" /><path d="M6.61 6.61A13.52 13.52 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" /><path d="m2 2 20 20" /></>,
        toggleOn: <><rect width="44" height="24" x="2" y="5" rx="12" fill="currentColor" /></>,
        toggleOff: <><rect width="44" height="24" x="2" y="5" rx="12" stroke="currentColor" fill="none" strokeWidth="2" /></>,
      };

      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          {icons[name] || null}
        </svg>
      );
    };

    const AdminPanel = () => {
      const [authenticated, setAuthenticated] = useState(false);
      const [password, setPassword] = useState('');
      const [activeTab, setActiveTab] = useState('accounts');

      // 数据状态
      const [accounts, setAccounts] = useState([]);
      const [announcement, setAnnouncement] = useState(null);
      const [config, setConfig] = useState({ contact: { name: '', email: '', feishuUrl: '' } });
      const [dbData, setDbData] = useState([]);

      // 表单状态
      const [editingAccount, setEditingAccount] = useState(null);
      const [newAccount, setNewAccount] = useState({ name: '', email: '', password: '', secret: '' });
      const [newAnnouncement, setNewAnnouncement] = useState('');
      const [contactForm, setContactForm] = useState({ name: '', email: '', openId: '' });
      const [buttonConfigs, setButtonConfigs] = useState({});

      // 消息提示
      const [message, setMessage] = useState(null);

      // 登录
      const handleLogin = (e) => {
        e.preventDefault();
        // 直接从 window.ADMIN_PASSWORD 读取，支持动态修改密码
        if (password === window.ADMIN_PASSWORD) {
          setAuthenticated(true);
          loadAllData();
        } else {
          showMessage('密码错误', 'error');
        }
      };

      // 显示消息
      const showMessage = (text, type = 'success') => {
        setMessage({ text, type });
        setTimeout(() => setMessage(null), 3000);
      };

      // 加载所有数据：Supabase 或 localStorage
      const loadAllData = async () => {
        try {
          if (useSupabase && supabase) {
            const [accRes, annRes, confRes] = await Promise.all([
              supabase.from('accounts').select('*').order('created_at', { ascending: false }),
              supabase.from('announcements').select('*').order('created_at', { ascending: false }).limit(1),
              supabase.from('config').select('*').eq('id', 'default').single()
            ]);
            const accList = accRes.data || [];
            setAccounts(accList);
            setDbData(accList);
            setAnnouncement(annRes.data && annRes.data[0] ? annRes.data[0] : null);
            const conf = confRes.data || {};
            const contact = { ...DEFAULT_CONFIG.contact, ...conf.contact };
            const buttons = { ...DEFAULT_CONFIG.buttons, ...conf.buttons };
            setConfig({ contact, buttons });
            setButtonConfigs(buttons);
            setContactForm({ name: contact.name || '', email: contact.email || '', openId: contact.openId || '' });
          } else {
            const rawAcc = localStorage.getItem(STORAGE_KEYS.accounts) || '[]';
            const accList = JSON.parse(rawAcc);
            setAccounts(accList);
            setDbData(accList);
            const rawAnn = localStorage.getItem(STORAGE_KEYS.announcement);
            setAnnouncement(rawAnn ? JSON.parse(rawAnn) : null);
            const rawConf = localStorage.getItem(STORAGE_KEYS.config);
            const conf = rawConf ? JSON.parse(rawConf) : DEFAULT_CONFIG;
            const contact = { ...DEFAULT_CONFIG.contact, ...conf.contact };
            const buttons = { ...DEFAULT_CONFIG.buttons, ...conf.buttons };
            setConfig({ contact, buttons });
            setButtonConfigs(buttons);
            setContactForm({ name: contact.name || '', email: contact.email || '', openId: contact.openId || '' });
          }
        } catch (err) {
          showMessage('加载数据失败', 'error');
        }
      };

      // 账号操作
      const handleAddAccount = async () => {
        if (!newAccount.email || !newAccount.password) {
          showMessage('邮箱和密码不能为空', 'error');
          return;
        }
        const id = Date.now().toString();
        const now = new Date().toISOString();
        const item = { id, name: newAccount.name || '', email: newAccount.email, password: newAccount.password, secret: newAccount.secret || '', created_at: now, updated_at: now };
        if (useSupabase && supabase) {
          const { error } = await supabase.from('accounts').insert(item);
          if (error) { showMessage(error.message || '添加失败', 'error'); return; }
        } else {
          const list = [...accounts, item];
          localStorage.setItem(STORAGE_KEYS.accounts, JSON.stringify(list));
        }
        showMessage('账号添加成功');
        setNewAccount({ name: '', email: '', password: '', secret: '' });
        loadAllData();
      };

      const handleUpdateAccount = async (id) => {
        const now = new Date().toISOString();
        const item = { ...editingAccount, id, updated_at: now };
        if (useSupabase && supabase) {
          const { error } = await supabase.from('accounts').update({ name: item.name, email: item.email, password: item.password, secret: item.secret || '', updated_at: now }).eq('id', id);
          if (error) { showMessage(error.message || '更新失败', 'error'); return; }
        } else {
          const list = accounts.map(a => a.id === id ? item : a);
          localStorage.setItem(STORAGE_KEYS.accounts, JSON.stringify(list));
        }
        showMessage('账号更新成功');
        setEditingAccount(null);
        loadAllData();
      };

      const handleDeleteAccount = async (id) => {
        if (!confirm('确定要删除这个账号吗？')) return;
        if (useSupabase && supabase) {
          const { error } = await supabase.from('accounts').delete().eq('id', id);
          if (error) { showMessage(error.message || '删除失败', 'error'); return; }
        } else {
          const list = accounts.filter(a => a.id !== id);
          localStorage.setItem(STORAGE_KEYS.accounts, JSON.stringify(list));
        }
        showMessage('账号删除成功');
        loadAllData();
      };

      // 公告操作
      const handleUpdateAnnouncement = async () => {
        if (!newAnnouncement.trim()) {
          showMessage('公告内容不能为空', 'error');
          return;
        }
        const item = { id: Date.now().toString(), message: newAnnouncement.trim(), created_at: new Date().toISOString() };
        if (useSupabase && supabase) {
          const { error } = await supabase.from('announcements').insert(item);
          if (error) { showMessage(error.message || '发布失败', 'error'); return; }
        } else {
          localStorage.setItem(STORAGE_KEYS.announcement, JSON.stringify(item));
        }
        showMessage('公告发布成功');
        setNewAnnouncement('');
        loadAllData();
      };

      const handleDeleteAnnouncement = async () => {
        if (useSupabase && supabase) {
          const { data: list } = await supabase.from('announcements').select('id');
          const ids = (list || []).map(r => r.id);
          if (ids.length) {
            const { error } = await supabase.from('announcements').delete().in('id', ids);
            if (error) { showMessage(error.message || '删除失败', 'error'); return; }
          }
        } else {
          localStorage.removeItem(STORAGE_KEYS.announcement);
        }
        showMessage('公告已删除');
        loadAllData();
      };

      // 技术支持配置
      const handleUpdateContact = async () => {
        if (useSupabase && supabase) {
          const { data: cur } = await supabase.from('config').select('*').eq('id', 'default').single();
          const contact = { ...DEFAULT_CONFIG.contact, ...(cur && cur.contact), ...contactForm };
          const buttons = (cur && cur.buttons) || DEFAULT_CONFIG.buttons;
          const { error } = await supabase.from('config').upsert({ id: 'default', contact, buttons }, { onConflict: 'id' });
          if (error) { showMessage(error.message || '更新失败', 'error'); return; }
        } else {
          const raw = localStorage.getItem(STORAGE_KEYS.config);
          const conf = raw ? JSON.parse(raw) : { contact: {}, buttons: {} };
          conf.contact = { ...DEFAULT_CONFIG.contact, ...contactForm };
          localStorage.setItem(STORAGE_KEYS.config, JSON.stringify(conf));
        }
        showMessage('配置更新成功');
        loadAllData();
      };

      // 按钮配置
      const handleUpdateButton = async (key, cfg) => {
        if (useSupabase && supabase) {
          const { data: cur } = await supabase.from('config').select('*').eq('id', 'default').single();
          const contact = (cur && cur.contact) || DEFAULT_CONFIG.contact;
          const buttons = { ...(cur && cur.buttons), ...DEFAULT_CONFIG.buttons };
          buttons[key] = { ...(buttons[key] || {}), ...cfg };
          const { error } = await supabase.from('config').upsert({ id: 'default', contact, buttons }, { onConflict: 'id' });
          if (error) { showMessage(error.message || '更新失败', 'error'); return; }
        } else {
          const raw = localStorage.getItem(STORAGE_KEYS.config);
          const conf = raw ? JSON.parse(raw) : { contact: DEFAULT_CONFIG.contact, buttons: DEFAULT_CONFIG.buttons };
          conf.buttons = conf.buttons || {};
          conf.buttons[key] = { ...(conf.buttons[key] || {}), ...cfg };
          localStorage.setItem(STORAGE_KEYS.config, JSON.stringify(conf));
        }
        showMessage('按钮配置更新成功');
        loadAllData();
      };

      // 登录界面
      if (!authenticated) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100">
            <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
              <div className="text-center mb-8">
                <div className="w-16 h-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <Icon name="lock" size={32} className="text-white" />
                </div>
                <h1 className="text-2xl font-bold text-slate-800">系统管理</h1>
                <p className="text-slate-500 text-sm mt-2">请输入管理员密码</p>
              </div>

              <form onSubmit={handleLogin}>
                <div className="mb-6">
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="管理员密码"
                    className="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                    autoFocus
                  />
                </div>
                <button
                  type="submit"
                  className="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity"
                >
                  登录
                </button>
              </form>
            </div>
          </div>
        );
      }

      // 主界面
      return (
        <div className="min-h-screen bg-slate-100">
          {/* 顶部导航 */}
          <header className="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-10">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center h-16">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center">
                    <Icon name="settings" size={20} className="text-white" />
                  </div>
                  <h1 className="text-xl font-bold text-slate-800">系统管理</h1>
                </div>
                <div className="flex items-center gap-2">
                  <a
                    href="/"
                    className="flex items-center gap-2 px-4 py-2 text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors"
                  >
                    <Icon name="home" size={18} />
                    返回首页
                  </a>
                </div>
              </div>
            </div>
          </header>

          {/* 标签导航 */}
          <div className="bg-white border-b border-slate-200">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <nav className="flex gap-8">
                {[
                  { key: 'accounts', label: '账号管理', icon: 'user' },
                  { key: 'announcement', label: '公告管理', icon: 'bell' },
                  { key: 'contact', label: '技术支持', icon: 'message' },
                  { key: 'buttons', label: '按钮配置', icon: 'settings' },
                  { key: 'database', label: '数据库', icon: 'database' },
                ].map(tab => (
                  <button
                    key={tab.key}
                    onClick={() => setActiveTab(tab.key)}
                    className={`flex items-center gap-2 px-4 py-4 border-b-2 transition-colors ${
                      activeTab === tab.key
                        ? 'border-blue-600 text-blue-600 font-semibold'
                        : 'border-transparent text-slate-500 hover:text-slate-700'
                    }`}
                  >
                    <Icon name={tab.icon} size={18} />
                    {tab.label}
                  </button>
                ))}
              </nav>
            </div>
          </div>

          {/* 内容区域 */}
          <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {/* 消息提示 */}
            {message && (
              <div className={`mb-6 p-4 rounded-xl flex items-center justify-between ${
                message.type === 'error' ? 'bg-red-50 text-red-700 border border-red-200' : 'bg-green-50 text-green-700 border border-green-200'
              }`}>
                <span>{message.text}</span>
                <button onClick={() => setMessage(null)} className="p-1 hover:bg-white/50 rounded">
                  <Icon name="x" size={16} />
                </button>
              </div>
            )}

            {/* 账号管理 */}
            {activeTab === 'accounts' && (
              <div className="space-y-6">
                {/* 添加账号 */}
                <div className="bg-white rounded-2xl shadow-sm p-6">
                  <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">
                    <Icon name="plus" size={20} />
                    添加新账号
                  </h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                    <input
                      placeholder="备注名称"
                      value={newAccount.name}
                      onChange={(e) => setNewAccount({ ...newAccount, name: e.target.value })}
                      className="px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                    <input
                      placeholder="Google 账号"
                      value={newAccount.email}
                      onChange={(e) => setNewAccount({ ...newAccount, email: e.target.value })}
                      className="px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                    <input
                      type="password"
                      placeholder="密码"
                      value={newAccount.password}
                      onChange={(e) => setNewAccount({ ...newAccount, password: e.target.value })}
                      className="px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                    <input
                      placeholder="2FA 密钥"
                      value={newAccount.secret}
                      onChange={(e) => setNewAccount({ ...newAccount, secret: e.target.value })}
                      className="px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                  </div>
                  <button
                    onClick={handleAddAccount}
                    className="px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                  >
                    添加账号
                  </button>
                </div>

                {/* 账号列表 */}
                <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                  <table className="w-full">
                    <thead className="bg-slate-50 border-b border-slate-200">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase">备注</th>
                        <th className="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase">账号</th>
                        <th className="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase">密码</th>
                        <th className="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase">2FA</th>
                        <th className="px-6 py-3 text-right text-xs font-semibold text-slate-600 uppercase">操作</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-200">
                      {accounts.map(acc => (
                        <tr key={acc.id} className="hover:bg-slate-50">
                          {editingAccount?.id === acc.id ? (
                            <>
                              <td className="px-6 py-4">
                                <input
                                  value={editingAccount.name}
                                  onChange={(e) => setEditingAccount({ ...editingAccount, name: e.target.value })}
                                  className="px-3 py-1 border rounded w-full"
                                />
                              </td>
                              <td className="px-6 py-4">
                                <input
                                  value={editingAccount.email}
                                  onChange={(e) => setEditingAccount({ ...editingAccount, email: e.target.value })}
                                  className="px-3 py-1 border rounded w-full"
                                />
                              </td>
                              <td className="px-6 py-4">
                                <input
                                  value={editingAccount.password}
                                  onChange={(e) => setEditingAccount({ ...editingAccount, password: e.target.value })}
                                  className="px-3 py-1 border rounded w-full"
                                />
                              </td>
                              <td className="px-6 py-4">
                                <input
                                  value={editingAccount.secret}
                                  onChange={(e) => setEditingAccount({ ...editingAccount, secret: e.target.value })}
                                  className="px-3 py-1 border rounded w-full"
                                />
                              </td>
                              <td className="px-6 py-4 text-right">
                                <button
                                  onClick={() => handleUpdateAccount(acc.id)}
                                  className="px-3 py-1 bg-green-600 text-white rounded text-sm mr-2"
                                >
                                  <Icon name="save" size={16} />
                                </button>
                                <button
                                  onClick={() => setEditingAccount(null)}
                                  className="px-3 py-1 bg-slate-400 text-white rounded text-sm"
                                >
                                  取消
                                </button>
                              </td>
                            </>
                          ) : (
                            <>
                              <td className="px-6 py-4 font-medium">{acc.name || '-'}</td>
                              <td className="px-6 py-4">{acc.email}</td>
                              <td className="px-6 py-4 font-mono text-sm">••••••••</td>
                              <td className="px-6 py-4">{acc.secret ? '●●●●●●' : '-'}</td>
                              <td className="px-6 py-4 text-right">
                                <button
                                  onClick={() => setEditingAccount(acc)}
                                  className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg mr-1"
                                  title="编辑"
                                >
                                  <Icon name="edit" size={16} />
                                </button>
                                <button
                                  onClick={() => handleDeleteAccount(acc.id)}
                                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                                  title="删除"
                                >
                                  <Icon name="trash" size={16} />
                                </button>
                              </td>
                            </>
                          )}
                        </tr>
                      ))}
                      {accounts.length === 0 && (
                        <tr>
                          <td colSpan="5" className="px-6 py-12 text-center text-slate-400">
                            暂无账号数据
                          </td>
                        </tr>
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {/* 公告管理 */}
            {activeTab === 'announcement' && (
              <div className="space-y-6">
                <div className="bg-white rounded-2xl shadow-sm p-6">
                  <h2 className="text-lg font-semibold mb-4">发布公告</h2>
                  <textarea
                    value={newAnnouncement}
                    onChange={(e) => setNewAnnouncement(e.target.value)}
                    placeholder="输入公告内容..."
                    className="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                    rows={3}
                  />
                  <div className="mt-4 flex gap-3">
                    <button
                      onClick={handleUpdateAnnouncement}
                      className="px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                    >
                      发布公告
                    </button>
                    {announcement && (
                      <button
                        onClick={handleDeleteAnnouncement}
                        className="px-6 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors"
                      >
                        删除当前公告
                      </button>
                    )}
                  </div>
                </div>

                {/* 当前公告 */}
                {announcement && (
                  <div className="bg-blue-50 border border-blue-200 rounded-2xl p-6">
                    <div className="flex items-start justify-between">
                      <div>
                        <h3 className="text-sm font-semibold text-blue-900 mb-2">当前公告</h3>
                        <p className="text-blue-800">{announcement.message}</p>
                        <p className="text-blue-600 text-xs mt-2">发布时间: {announcement.created_at}</p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* 技术支持配置 */}
            {activeTab === 'contact' && (
              <div className="bg-white rounded-2xl shadow-sm p-6">
                <h2 className="text-lg font-semibold mb-6">技术支持配置</h2>
                <div className="space-y-4 max-w-lg">
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">联系人名称</label>
                    <input
                      type="text"
                      value={contactForm.name}
                      onChange={(e) => setContactForm({ ...contactForm, name: e.target.value })}
                      className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">联系邮箱</label>
                    <input
                      type="email"
                      value={contactForm.email}
                      onChange={(e) => setContactForm({ ...contactForm, email: e.target.value })}
                      className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">
                      飞书 Open ID
                      <a
                        href="https://open.feishu.cn/document/server-docs/contact-v3/user/batch_get_id"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="ml-2 text-blue-600 text-xs hover:underline"
                      >
                        如何获取?
                      </a>
                    </label>
                    <input
                      type="text"
                      value={contactForm.openId}
                      onChange={(e) => setContactForm({ ...contactForm, openId: e.target.value })}
                      placeholder="ou_xxxxxxxxxxxxxxxx"
                      className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm"
                    />
                  </div>
                  <button
                    onClick={handleUpdateContact}
                    className="px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                  >
                    保存配置
                  </button>
                </div>

                {/* 预览 */}
                <div className="mt-8 pt-8 border-t border-slate-200">
                  <h3 className="text-sm font-semibold text-slate-700 mb-4">预览</h3>
                  <div className="p-4 bg-slate-50 rounded-lg">
                    <p className="text-sm text-slate-600">
                      <span className="font-medium">技术支持:</span> {contactForm.name}
                    </p>
                    <p className="text-sm text-slate-600 mt-1">
                      <span className="font-medium">邮箱:</span> {contactForm.email}
                    </p>
                    <p className="text-sm text-slate-600 mt-1">
                      <span className="font-medium">飞书链接:</span>
                      <code className="ml-2 px-2 py-0.5 bg-slate-200 rounded text-xs">
                        {contactForm.openId ? `https://applink.feishu.cn/client/chat/open?openId=${contactForm.openId}` : '未配置'}
                      </code>
                    </p>
                  </div>
                </div>
              </div>
            )}

            {/* 按钮配置 */}
            {activeTab === 'buttons' && (
              <div className="space-y-6">
                {[
                  { key: 'guide', label: '登录指导', desc: '显示账号登录操作指南弹窗' },
                  { key: 'gemini', label: '访问 Gemini', desc: '跳转到 Gemini AI 页面' },
                ].map(btn => (
                  <div key={btn.key} className="bg-white rounded-2xl shadow-sm p-6">
                    <div className="flex items-center justify-between mb-4">
                      <div>
                        <h3 className="font-semibold text-slate-800">{btn.label}</h3>
                        <p className="text-sm text-slate-500">{btn.desc}</p>
                      </div>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <span className="text-sm text-slate-600">显示</span>
                        <input
                          type="checkbox"
                          checked={buttonConfigs[btn.key]?.visible !== false}
                          onChange={(e) => handleUpdateButton(btn.key, { ...buttonConfigs[btn.key], visible: e.target.checked })}
                          className="w-5 h-5 rounded text-blue-600"
                        />
                      </label>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">按钮文字</label>
                        <input
                          type="text"
                          value={buttonConfigs[btn.key]?.text || btn.label}
                          onChange={(e) => handleUpdateButton(btn.key, { ...buttonConfigs[btn.key], text: e.target.value })}
                          className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-slate-700 mb-2">跳转链接</label>
                        <input
                          type="text"
                          value={buttonConfigs[btn.key]?.url || ''}
                          onChange={(e) => handleUpdateButton(btn.key, { ...buttonConfigs[btn.key], url: e.target.value })}
                          placeholder={btn.key === 'gemini' ? 'https://gemini.google.com/app' : 'javascript:void(0)'}
                          className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm"
                        />
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* 数据库查看 */}
            {activeTab === 'database' && (
              <div className="bg-white rounded-2xl shadow-sm p-6">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-lg font-semibold">数据库数据</h2>
                  <button
                    onClick={loadAllData}
                    className="flex items-center gap-2 px-4 py-2 text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors"
                  >
                    <Icon name="refresh" size={16} />
                    刷新
                  </button>
                </div>

                <div className="overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-slate-50 border-b border-slate-200">
                      <tr>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">ID</th>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">备注</th>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">账号</th>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">密码</th>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">2FA密钥</th>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">创建时间</th>
                        <th className="px-4 py-3 text-left font-semibold text-slate-600">更新时间</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-200">
                      {dbData.map((row, idx) => (
                        <tr key={idx} className="hover:bg-slate-50 font-mono">
                          <td className="px-4 py-3 text-slate-600">{row.id}</td>
                          <td className="px-4 py-3">{row.name || '-'}</td>
                          <td className="px-4 py-3">{row.email}</td>
                          <td className="px-4 py-3 text-slate-500">••••••••</td>
                          <td className="px-4 py-3 text-slate-500">{row.secret ? '●●●●●●' : '-'}</td>
                          <td className="px-4 py-3 text-slate-500 text-xs">{row.created_at}</td>
                          <td className="px-4 py-3 text-slate-500 text-xs">{row.updated_at}</td>
                        </tr>
                      ))}
                      {dbData.length === 0 && (
                        <tr>
                          <td colSpan="7" className="px-4 py-12 text-center text-slate-400">
                            数据库为空
                          </td>
                        </tr>
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </main>
        </div>
      );
    };

    // 渲染应用
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AdminPanel />);
  </script>
</body>
</html>
