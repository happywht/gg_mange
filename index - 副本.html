<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>谷歌智能登录助手</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

   <!-- Feishu Passport -->
  <script src="https://lf1-cdn-tos.bytegoofy.com/obj/static/lark/passport/qrcode/LarkSSO-1.0.2.js"></script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- OTPAuth -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/otpauth/9.1.2/otpauth.umd.min.js"></script>

  <!-- Supabase 和认证系统（按顺序加载） -->
  <script src="supabase-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="auth-manager.js"></script>
  <script src="auth-check.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    .mode-switch {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s;
    }
    .mode-switch:hover {
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Supabase 客户端（配置了 URL 和 Key 才创建）
    const supabase = (typeof window !== 'undefined' && window.SUPABASE_URL && window.SUPABASE_ANON_KEY && typeof window.supabase !== 'undefined')
      ? window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY)
      : null;

    // 存储模式：local 或 cloud
    const getStorageMode = () => {
      const saved = localStorage.getItem('google_assistant_storage_mode');
      if (saved) return saved;
      // 默认优先使用云端模式（如果配置了），否则使用本地模式
      return supabase ? 'cloud' : 'local';
    };

    const STORAGE_KEYS = {
      accounts: 'google_assistant_accounts',
      announcement: 'google_assistant_announcement',
      config: 'google_assistant_config'
    };
    // 常用AI服务配置
    const AI_SERVICES = [
      { id: 'gemini', name: 'Gemini', url: 'https://gemini.google.com/app', icon: 'sparkles', color: 'bg-blue-500' },
      { id: 'notebooklm', name: 'NotebookLM', url: 'https://notebooklm.google.com', icon: 'fileText', color: 'bg-emerald-500' },
      { id: 'cursor', name: 'Cursor', url: 'https://cursor.com', icon: 'code', color: 'bg-violet-500' },
      { id: 'chatgpt', name: 'ChatGPT', url: 'https://chat.openai.com', icon: 'bot', color: 'bg-green-500' }
    ];

    const DEFAULT_CONFIG = {
      contact: { name: '王海涛', email: 'wanghaitao@sucdri.com', openId: 'ou_f28f2c1dfe74461b2ca055dfe2afe20b' },
      buttons: {
        guide: { visible: true, text: '操作说明', url: '' },
        gemini: { visible: true, text: '登录 Google', url: 'https://accounts.google.com' }
      },
      visibleServices: [],
      permissions: {
        showAddAccount: true,
        showDeleteButton: true,
        showModeSwitch: true
      }
    };
    function withFeishuUrl(c) {
      const openId = (c && c.contact && c.contact.openId) ? c.contact.openId : '';
      return {
        ...c,
        contact: { ...(c.contact || {}), feishuUrl: openId ? `https://applink.feishu.cn/client/chat/open?openId=${openId}` : '' }
      };
    }
    function getConfigFromLocal() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.config);
        if (!raw) return withFeishuUrl(DEFAULT_CONFIG);
        const saved = JSON.parse(raw);
        return withFeishuUrl({
          contact: { ...DEFAULT_CONFIG.contact, ...saved.contact },
          buttons: { ...DEFAULT_CONFIG.buttons, ...saved.buttons },
          visibleServices: saved.visibleServices || DEFAULT_CONFIG.visibleServices,
          permissions: { ...DEFAULT_CONFIG.permissions, ...saved.permissions }
        });
      } catch {
        return withFeishuUrl(DEFAULT_CONFIG);
      }
    }

    // --- 自定义内联图标组件 ---
    const Icon = ({ name, size = 20, className = "" }) => {
      const icons = {
        key: (
          <>
            <path d="m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4.1a1 1 0 0 0-1.4 0l-2.1 2.1a1 1 0 0 0 0 1.4Z" />
            <path d="m10.5 12.5 1.5 1.5" />
            <path d="M11 11l4.5-4.5" />
            <path d="M4.5 16.5 7 14" />
            <path d="M3 21l3-3" />
            <path d="m21 3-5 5" />
            <path d="M14 9a7 7 0 1 1-10 10 7 7 0 0 1 10-10Z" />
          </>
        ),
        user: (
          <>
            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </>
        ),
        shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" />,
        copy: (
          <>
            <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
          </>
        ),
        check: <path d="M20 6 9 17l-5-5" />,
        eye: (
          <>
            <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
            <circle cx="12" cy="12" r="3" />
          </>
        ),
        eyeOff: (
          <>
            <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
            <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" />
            <path d="M6.61 6.61A13.52 13.52 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" />
            <path d="m2 2 20 20" />
          </>
        ),
        plus: (
          <>
            <path d="M12 5v14" />
            <path d="M5 12h14" />
          </>
        ),
        trash: (
          <>
            <path d="M3 6h18" />
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
            <path d="M10 11v6" />
            <path d="M14 11v6" />
          </>
        ),
        clock: (
          <>
            <circle cx="12" cy="12" r="10" />
            <path d="M12 6v6l4 2" />
          </>
        ),
        cloud: <path d="M17.5 19c3.037 0 5.5-2.463 5.5-5.5 0-2.57-1.78-4.735-4.184-5.312a7.002 7.002 0 0 0-13.316 1.056C2.122 10.044 0 12.51 0 15.5 0 18.537 2.463 21 5.5 21h12" />,
        database: (
          <>
            <ellipse cx="12" cy="5" rx="9" ry="3" />
            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" />
            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" />
          </>
        ),
        server: (
          <>
            <rect width="20" height="8" x="2" y="2" rx="2" ry="2" />
            <rect width="20" height="8" x="2" y="14" rx="2" ry="2" />
            <line x1="6" x2="6.01" y1="6" y2="6" />
            <line x1="6" x2="6.01" y1="18" y2="18" />
          </>
        ),
        bell: (
          <>
            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
            <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
          </>
        ),
        x: (
          <>
            <path d="M18 6 6 18" />
            <path d="M6 6l12 12" />
          </>
        ),
        alert: (
          <>
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
            <path d="M12 9v4" />
            <path d="M12 17h.01" />
          </>
        ),
        link: (
          <>
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
            <path d="M15 3h6v6" />
            <path d="M10 14 21 3" />
          </>
        ),
        help: (
          <>
            <circle cx="12" cy="12" r="10" />
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
            <path d="M12 17h.01" />
          </>
        ),
        sparkles: <path d="m12 3 1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3Z" />,
        message: <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10Z" />,
        feishu: (
          <>
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
          </>
        ),
        refresh: (
          <>
            <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
            <path d="M3 3v5h5" />
            <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
            <path d="M16 21h5v-5" />
          </>
        ),
        fileText: (
          <>
            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" x2="8" y1="13" y2="13" />
            <line x1="16" x2="8" y1="17" y2="17" />
            <line x1="10" x2="8" y1="9" y2="9" />
          </>
        ),
        code: (
          <>
            <polyline points="16 18 22 12 16 6" />
            <polyline points="8 6 2 12 8 18" />
          </>
        ),
        bot: (
          <>
            <path d="M12 8V4H8" />
            <rect width="16" height="12" x="4" y="8" rx="2" />
            <path d="M2 14h2" />
            <path d="M20 14h2" />
            <path d="M15 13v2" />
            <path d="M9 13v2" />
          </>
        )
      };

      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          {icons[name] || null}
        </svg>
      );
    };

    const App = () => {
      const [userInfo, setUserInfo] = useState({ name: '授权用户', avatar: '', isFeishu: false });
      const [accounts, setAccounts] = useState([]);
      const [announcement, setAnnouncement] = useState(null);
      const [newAcc, setNewAcc] = useState({ name: '', email: '', password: '', secret: '' });
      const [showPassword, setShowPassword] = useState({});
      const [copiedField, setCopiedField] = useState(null);
      const [tokens, setTokens] = useState({});
      const [timeLeft, setTimeLeft] = useState(30);
      const [loading, setLoading] = useState(true);
      const [errorMsg, setErrorMsg] = useState(null);
      const [showGuide, setShowGuide] = useState(false);
      const [config, setConfig] = useState(() => getConfigFromLocal());
      const [storageMode, setStorageMode] = useState(() => getStorageMode());
      const [permissions, setPermissions] = useState({
        showAddAccount: true,
        showDeleteButton: true,
        showModeSwitch: true
      });

      // 切换存储模式
      const toggleStorageMode = async (mode) => {
        setLoading(true);
        setStorageMode(mode);
        localStorage.setItem('google_assistant_storage_mode', mode);
        // 传递 showLoading=true，确保加载完成后设置 loading=false
        await loadData(mode, true);
      };

      // 加载数据：Supabase 云端 或 本地 localStorage
      // showLoading: 是否显示加载状态（自动刷新时不显示）
      const loadData = async (mode = storageMode, showLoading = false) => {
        const useCloud = mode === 'cloud' && supabase;
        if (showLoading) setLoading(true);
        try {
          if (useCloud) {
            const [accRes, annRes, confRes] = await Promise.all([
              supabase.from('accounts').select('*').order('created_at', { ascending: false }),
              supabase.from('announcements').select('*').order('created_at', { ascending: false }).limit(1),
              supabase.from('config').select('*').eq('id', 'default').single()
            ]);
            const list = (accRes.data || []).map(a => ({ ...a, hasSecret: !!a.secret }));
            setAccounts(list);
            const annRow = annRes.data && annRes.data[0];
            setAnnouncement(annRow && annRow.message ? annRow : null);
            const conf = confRes.data;
            if (conf && (conf.contact || conf.buttons)) {
              setConfig(withFeishuUrl({
                contact: { ...DEFAULT_CONFIG.contact, ...conf.contact },
                buttons: { ...DEFAULT_CONFIG.buttons, ...conf.buttons },
                visibleServices: conf.visible_services || DEFAULT_CONFIG.visibleServices,
                permissions: conf.permissions || DEFAULT_CONFIG.permissions
              }));
              if (conf.permissions) {
                setPermissions(conf.permissions);
              }
            }
            setErrorMsg(null);
          } else {
            const raw = localStorage.getItem(STORAGE_KEYS.accounts) || '[]';
            const list = JSON.parse(raw).map(a => ({ ...a, hasSecret: !!a.secret }));
            setAccounts(list);
            const ann = localStorage.getItem(STORAGE_KEYS.announcement);
            if (ann) {
              try {
                const obj = JSON.parse(ann);
                if (obj && obj.message) setAnnouncement(obj);
              } catch (_) {}
            } else setAnnouncement(null);
            setConfig(getConfigFromLocal());
            setErrorMsg(null);
          }
        } catch (e) {
          console.error('数据加载失败', e);
          setErrorMsg(mode === 'cloud' ? '云端数据加载失败' : '本地数据加载失败');
        } finally {
          if (showLoading) setLoading(false);
        }
      };

      // 飞书 SSO：识别是否为飞书内置浏览器
      useEffect(() => {
          const checkFeishuSSO = async () => {
              // 检查是否在飞书内置浏览器中
              const isFeishuBrowser = /Lark|Feishu/i.test(navigator.userAgent);
              if (!isFeishuBrowser) return;

              // 等待飞书 H5 SDK 加载完成
              if (!window.h5sdk) {
                  console.warn('飞书 H5 SDK 未加载');
                  return;
              }

              window.h5sdk.ready(() => {
                  if (!tt || !tt.requestAuthCode) {
                      console.error('飞书 SDK 不可用');
                      return;
                  }

                  tt.requestAuthCode({
                      appId: 'cli_a90a87e94ab85bd8', // 与 server.js 中的 LARK_APP_ID 一致
                      success: async (res) => {
                          try {
                              // 调用后端接口换取 open_id
                              const authRes = await fetch('/api/auth/feishu-sso', {
                                  method: 'POST',
                                  headers: { 'Content-Type': 'application/json' },
                                  body: JSON.stringify({ code: res.code })
                              });

                              if (!authRes.ok) {
                                  throw new Error(`HTTP ${authRes.status}`);
                              }

                              const result = await authRes.json();

                              if (result.success && result.user) {
                                  // 1. 更新 UI 用户信息
                                  setUserInfo({
                                      name: result.user.name || '飞书用户',
                                      avatar: result.user.avatar_url || '',
                                      isFeishu: true
                                  });

                                  // 2. 从 Supabase 加载该 open_id 绑定的账号
                                  const { data, error } = await supabase
                                      .from('secure_accounts')
                                      .select('*')
                                      .eq('feishu_openid', result.user.open_id);

                                  if (error) {
                                      console.error('查询账号失败:', error);
                                  } else if (data && data.length > 0) {
                                      setAccounts(data);
                                      console.log(`已加载 ${data.length} 个绑定的账号`);
                                  } else {
                                      console.log('该飞书用户暂无绑定账号');
                                  }
                              } else {
                                  console.error('飞书认证失败:', result.error);
                              }
                          } catch (error) {
                              console.error('飞书 SSO 处理异常:', error);
                          }
                      },
                      fail: (error) => {
                          console.error('飞书授权码获取失败:', error);
                      }
                  });
              });
          };

          // 延迟执行，确保 SDK 加载完成
          setTimeout(checkFeishuSSO, 500);
      }, []);

      // 1. 首次加载
      useEffect(() => {
        const initLoad = async () => {
          setLoading(true);
          await loadData(storageMode, false); // 首次加载不显示 loading，避免闪烁
          setLoading(false);
        };
        initLoad();
      }, []);

      // 2a. 本地模式：多标签同步（localStorage 变化时刷新）
      useEffect(() => {
        if (storageMode === 'cloud') return;
        const onStorage = (e) => {
          if (e.key === STORAGE_KEYS.accounts || e.key === STORAGE_KEYS.announcement || e.key === STORAGE_KEYS.config) loadData();
        };
        window.addEventListener('storage', onStorage);
        return () => window.removeEventListener('storage', onStorage);
      }, []);

      // 2b. 云端模式：Supabase 实时订阅（管理页或他人更新时自动刷新）
      useEffect(() => {
        if (storageMode !== 'cloud' || !supabase) return;
        const channel = supabase.channel('public-changes')
          .on('postgres_changes', { event: '*', schema: 'public', table: 'accounts' }, () => loadData())
          .on('postgres_changes', { event: '*', schema: 'public', table: 'announcements' }, () => loadData())
          .on('postgres_changes', { event: '*', schema: 'public', table: 'config' }, () => loadData())
          .subscribe();
        return () => { supabase.removeChannel(channel); };
      }, []);

      // 2. 定时更新 TOTP 与倒计时
      useEffect(() => {
        const timer = setInterval(() => {
          const seconds = Math.floor(Date.now() / 1000);
          setTimeLeft(30 - (seconds % 30));
          if (window.OTPAuth && accounts.length > 0) {
            const newTokens = {};
            accounts.forEach(acc => {
              if (acc.secret) {
                try {
                  const totp = new window.OTPAuth.TOTP({ secret: (acc.secret || '').replace(/\s/g, '').toUpperCase() });
                  newTokens[acc.id] = totp.generate();
                } catch (e) { newTokens[acc.id] = 'Error'; }
              }
            });
            setTokens(newTokens);
          }
        }, 1000);
        return () => clearInterval(timer);
      }, [accounts]);

      const addAccount = async () => {
        if (!newAcc.email || !newAcc.password) return;
        const docId = Date.now().toString();
        const now = new Date().toISOString();
        const row = { id: docId, name: newAcc.name || '', email: newAcc.email, password: newAcc.password, secret: newAcc.secret || '', created_at: now, updated_at: now };
        const useCloud = storageMode === 'cloud' && supabase;
        if (useCloud) {
          const { error } = await supabase.from('accounts').insert(row);
          if (error) { setErrorMsg(error.message || '添加失败'); return; }
          setErrorMsg(null);
          loadData();
        } else {
          const updated = [...accounts, { ...row, hasSecret: !!row.secret }];
          setAccounts(updated);
          localStorage.setItem(STORAGE_KEYS.accounts, JSON.stringify(updated.map(({ hasSecret, ...a }) => a)));
        }
        setNewAcc({ name: '', email: '', password: '', secret: '' });
      };

      const removeAccount = async (id) => {
        const useCloud = storageMode === 'cloud' && supabase;
        if (useCloud) {
          const { error } = await supabase.from('accounts').delete().eq('id', id);
          if (error) { setErrorMsg(error.message || '删除失败'); return; }
          loadData();
        } else {
          const updated = accounts.filter(a => a.id !== id);
          setAccounts(updated);
          localStorage.setItem(STORAGE_KEYS.accounts, JSON.stringify(updated.map(({ hasSecret, ...a }) => a)));
        }
      };

      const copyToClipboard = (text, fieldId) => {
        const el = document.createElement('textarea');
        el.value = text;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        setCopiedField(fieldId);
        setTimeout(() => setCopiedField(null), 2000);
      };

      // 纯前端模式：密码与 TOTP 均来自本地账号数据
      const getPassword = (id) => (accounts.find(a => a.id === id) || {}).password;

      if (loading) return (
        <div className="min-h-screen flex items-center justify-center bg-slate-50">
          <div className="flex flex-col items-center gap-4">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            <p className="text-slate-500 font-medium">应用加载中...</p>
          </div>
        </div>
      );

      return (
		<div className="flex min-h-screen bg-slate-50 text-slate-800 font-sans">
		  {/* 左侧侧边栏 - 核心导航 */}
		  <aside className="w-64 bg-[#0f172a] text-slate-300 flex flex-col shrink-0 shadow-xl">
			<div className="p-6 border-b border-slate-800">
			  <h1 className="text-white text-lg font-bold">SUCDRI 门户</h1>
			  <p className="text-[10px] text-slate-500 uppercase tracking-widest mt-1">账号安全管理系统</p>
			</div>
			
			<nav className="flex-1 p-4 space-y-1">
			  <button className="w-full flex items-center gap-3 px-4 py-2.5 bg-blue-600 text-white rounded-md text-sm font-medium transition-all">
				<Icon name="user" size={18} /> 账号列表
			  </button>

			  {/* AI服务导航区 - 根据配置动态显示 */}
			  {config.visibleServices === undefined || config.visibleServices.length < AI_SERVICES.length ? (
			    <div className="pt-4 pb-2">
			      <div className="px-4 pb-2 text-xs font-bold text-slate-500 uppercase tracking-wider">AI 服务</div>
			      {AI_SERVICES.map(service => {
			        if (config.visibleServices && config.visibleServices.length > 0 && !config.visibleServices.includes(service.id)) {
			          return null;
			        }
			        return (
			          <a key={service.id} href={service.url} target="_blank" rel="noopener noreferrer"
			             className="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-800 hover:text-white rounded-md text-sm transition-all group">
			            <div className={`w-5 h-5 ${service.color} rounded flex items-center justify-center text-white`}>
			              <Icon name={service.icon} size={12} />
			            </div>
			            <span className="flex-1">{service.name}</span>
			            <Icon name="link" size={12} className="opacity-50" />
			          </a>
			        );
			      })}
			    </div>
			  ) : null}

			  {/* 系统菜单 - 根据配置动态显示 */}
			  {(config.buttons?.gemini?.visible !== false || config.buttons?.guide?.visible !== false) && (
			    <div className="pt-4 pb-2 border-t border-slate-800">
			      <div className="px-4 pb-2 text-xs font-bold text-slate-500 uppercase tracking-wider">系统</div>

			      {/* 登录 Google */}
			      {config.buttons?.gemini?.visible !== false && (
			        <a href={config.buttons?.gemini?.url || 'https://accounts.google.com'} target="_blank" rel="noopener noreferrer"
			           className="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-800 hover:text-white rounded-md text-sm transition-all group">
			          <Icon name="sparkles" size={18} className="text-blue-400 group-hover:text-blue-300" /> {config.buttons?.gemini?.text || '登录 Google'}
			          <Icon name="link" size={12} className="ml-auto opacity-50" />
			        </a>
			      )}

			      {/* 操作指南 */}
			      {config.buttons?.guide?.visible !== false && (
			        <button onClick={() => setShowGuide(true)}
			            className="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-800 hover:text-white rounded-md text-sm transition-all">
			          <Icon name="help" size={18} /> {config.buttons?.guide?.text || '操作指南'}
			        </button>
			      )}
			    </div>
			  )}
			</nav>

			{/* 左下角：展示使用者信息，而非技术支持 */}
			<div className="p-4 bg-slate-900/80 border-t border-slate-800">
			  <div className="flex items-center gap-3 px-2">
				<div className="w-8 h-8 bg-slate-700 rounded-full flex items-center justify-center text-[10px] font-bold text-white border border-slate-600">
				  USER
				</div>
				<div className="min-w-0">
				  <p className="text-xs font-bold text-slate-200 truncate">{userInfo.name}</p>
				  <p className="text-[10px] text-slate-500 truncate">{userInfo.isFeishu ? '飞书认证用户' : 'SUCDRI 内部访问'}</p>
				</div>
			  </div>
			</div>
		  </aside>

		  {/* 右侧主内容区 */}
		  <main className="flex-1 flex flex-col min-w-0 overflow-hidden">
			{/* 顶部标题栏 - 去掉了之前的跳转按钮，更干净 */}
			<header className="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 shrink-0">
			  <div className="flex items-center gap-2">
				<div className="w-2 h-2 bg-green-500 rounded-full"></div>
				<span className="text-sm font-bold text-slate-600">系统运行正常</span>
			  </div>
			  <div className="flex items-center gap-4 text-blue-600">
				<Icon name="clock" size={16} />
				<span className="font-mono text-sm font-bold">2FA 验证码更新: {timeLeft}s</span>
			  </div>
			</header>

			{/* 列表区域 */}
			<div className="flex-1 p-8 overflow-y-auto">
			  <div className="max-w-5xl mx-auto">
				<div className="bg-white border border-slate-200 rounded-md shadow-sm overflow-hidden">
				  <table className="w-full text-left border-collapse">
					<thead>
					  <tr className="bg-slate-50 border-b border-slate-200">
						<th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">资源名称</th>
						<th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">Google 账号</th>
						<th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">管理操作</th>
						<th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">动态验证码</th>
					  </tr>
					</thead>
					<tbody className="divide-y divide-slate-100">
					  {accounts.map(acc => (
						<tr key={acc.id} className="hover:bg-slate-50/50">
						  <td className="px-6 py-5 font-bold text-slate-900">{acc.name || '默认资源'}</td>
						  <td className="px-6 py-5">
							<div className="flex items-center gap-2 group">
							  <span className="text-sm text-slate-600">{acc.email}</span>
							  <button onClick={() => copyToClipboard(acc.email, `e-${acc.id}`)} 
									  className="opacity-0 group-hover:opacity-100 text-blue-600 text-xs transition-opacity">复制</button>
							</div>
						  </td>
						  <td className="px-6 py-5">
							<button onClick={() => copyToClipboard(acc.password, `p-${acc.id}`)}
									className="px-3 py-1.5 border border-slate-200 rounded text-xs font-semibold hover:bg-slate-100 transition-all flex items-center gap-2">
							  <Icon name="key" size={14} /> 复制密码
							</button>
						  </td>
						  <td className="px-6 py-5">
							{acc.secret ? (
							  <div className="flex items-center gap-4">
								<span className="font-mono text-xl font-black tracking-[0.1em] text-blue-700">
								  {tokens[acc.id] || '------'}
								</span>
								<button onClick={() => copyToClipboard(tokens[acc.id], `t-${acc.id}`)} 
										className="p-2 bg-slate-900 text-white rounded hover:bg-black transition-transform active:scale-95">
								  <Icon name="copy" size={14} />
								</button>
							  </div>
							) : <span className="text-slate-300 italic">未启用</span>}
						  </td>
						</tr>
					  ))}
					</tbody>
				  </table>
				</div>
			  </div>
			</div>
		  </main>

		  {/* 右下角：悬浮技术支持按钮 - 既专业又显眼 */}
		  <a href={config.contact?.feishuUrl || '#'} target="_blank"
			 className="fixed bottom-8 right-8 flex items-center gap-2 px-4 py-2.5 bg-white border border-slate-200 rounded-full shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all z-50 group">
			<div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
			<span className="text-xs font-bold text-slate-700">技术支持 (王海涛)</span>
			<Icon name="message" size={16} className="text-slate-400 group-hover:text-blue-500" />
		  </a>
		</div>
	  );
	};

    // 渲染应用
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
